<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\andre\Source\School\BDSA2021-FinalProject\WebService.Core\Server\Model\ContentGenerator.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// ***********************************************************************
// Assembly         : WebService.Core.Server
// Author           : Group BTG
// Created          : 12-14-2021
//
// Last Modified By : Group BTG
// Last Modified On : 12-14-2021
// ***********************************************************************
// &lt;copyright file=&quot;ContentGenerator.cs&quot; company=&quot;BTG&quot;&gt;
//     Copyright (c) . All rights reserved.
// &lt;/copyright&gt;
// &lt;summary&gt;&lt;/summary&gt;
// ***********************************************************************

using ET.FakeText;

namespace WebService.Core.Server.Model;

/// &lt;summary&gt;
///     Generate titles and bodies of text.
///     Title generation is done without dependencies, all from within this class.
///     Text body generation leverages the FakeTextGenerator by etc coding. You can find the remote repository for this
///     Library here: https://github.com/etcoding/FakeTextGenerator
/// &lt;/summary&gt;
public class ContentGenerator
{
    /// &lt;summary&gt;
    ///     Enum Language
    /// &lt;/summary&gt;
    public enum Language
    {
        /// &lt;summary&gt;
        ///     The russian language
        /// &lt;/summary&gt;
        Russian,

        /// &lt;summary&gt;
        ///     The english language
        /// &lt;/summary&gt;
        English,

        /// &lt;summary&gt;
        ///     The italian language
        /// &lt;/summary&gt;
        Italian,

        /// &lt;summary&gt;
        ///     The danish language
        /// &lt;/summary&gt;
        Danish,

        /// &lt;summary&gt;
        ///     The unknown language
        /// &lt;/summary&gt;
        Unknown
    }

    /// &lt;summary&gt;
    ///     The random instance
    /// &lt;/summary&gt;
    private static readonly Random Rand = new();

    // Special thanks to https://www.nichelaboratory.com/Home/BlogTitleGenerator for generated clickbait titles
    /// &lt;summary&gt;
    ///     Template titles
    /// &lt;/summary&gt;
    private static readonly string[] TemplateTitles =
    {
        &quot;Creating a webapp with $1&quot;,
        &quot;Creating a high performance backend with $1&quot;,
        &quot;Understanding $1&quot;,
        &quot;$1 is being deprecated in 2022&quot;,
        &quot;$1 is so bad, Oracle is going to sue you for using it&quot;,
        &quot;Demystifying $1&quot;,
        &quot;Earn $100,000 a year with $1&quot;,
        &quot;Become a millionaire with $1 in 2022&quot;,
        &quot;Announcing $1&quot;,
        &quot;Introduction to $1&quot;,
        &quot;$1: Your first project&quot;,
        &quot;$1: Best practices&quot;,
        &quot;$1: Core concepts&quot;,
        &quot;Azure for $1: getting started&quot;,
        &quot;Azure for $1: advanced course&quot;,
        &quot;$1 in the Cloud: Getting Started&quot;,
        &quot;$1: Top ten best practices in 2021&quot;,
        &quot;When $1 Businesses Grow Too Quickly&quot;,
        &quot;A Guide To $1 At Any Age&quot;,
        &quot;The Biggest Myth About $1 Exposed&quot;,
        &quot;Life After $1&quot;,
        &quot;10 Ways You Can Grow Your Creativity Using $1&quot;,
        &quot;Don&#39;t Just Sit There! Start $1&quot;,
        &quot;Successful Stories You Did not Know About $1&quot;,
        &quot;Want A Thriving Business? Focus On $1!&quot;,
        &quot;$1 Creates Experts&quot;,
        &quot;Unanswered Questions Into $1 Revealed&quot;,
        &quot;14 Ways $1 Can Make You Invincible&quot;,
        &quot;Must Have List Of $1 Networks&quot;,
        &quot;$1 - Not For Everyone&quot;,
        &quot;How To Save Money With $1?&quot;,
        &quot;The Unadvertised Details Into $1 That Most People Don&#39;t Know About&quot;,
        &quot;Kids Love $1&quot;,
        &quot;Believe In Your $1 Skills But Never Stop Improving&quot;,
        &quot;$1 For Beginners And Everyone Else&quot;,
        &quot;7 Ways To Reinvent Your $1&quot;,
        &quot;Where Will $1 Be 12 Months From Now?&quot;,
        &quot;12 Tips To Start Building A $1 You Always Wanted&quot;,
        &quot;Take Advantage Of $1 - Read These 9 Tips&quot;
    };

    /// &lt;summary&gt;
    ///     The environment
    /// &lt;/summary&gt;
    private readonly IWebHostEnvironment? _environment;

    /// &lt;summary&gt;
    ///     The text generators
    /// &lt;/summary&gt;
    private readonly Dictionary&lt;Language, TextGenerator&gt; _textGenerators;


    /// &lt;summary&gt;
    ///     Initializes a new instance of the &lt;see cref=&quot;ContentGenerator&quot; /&gt; class.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;environment&quot;&gt;The environment.&lt;/param&gt;
    public ContentGenerator(IWebHostEnvironment? environment = null)
    {
        _environment = environment;
        _textGenerators = new Dictionary&lt;Language, TextGenerator&gt;();

        var languages = Enum.GetValues(typeof(Language)).Cast&lt;Language&gt;().ToList();
        foreach (var language in languages)
        {
            var (ok, lang) = LanguageToString(language);
            if (!ok) continue;

            _textGenerators.Add(language, GetTextGenerator(lang));
        }
    }

    /// &lt;summary&gt;
    ///     Gets the text generator.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;filename&quot;&gt;The filename.&lt;/param&gt;
    /// &lt;returns&gt;TextGenerator.&lt;/returns&gt;
    private TextGenerator GetTextGenerator(string filename)
    {
        var fileLocation = GetDataFileLocation($&quot;{filename}.corpus.txt&quot;);
        var corpusContent = File.ReadAllText(fileLocation);
        var corpus = Corpus.CreateFromText(corpusContent);
        return new TextGenerator(corpus);
    }

    /// &lt;summary&gt;
    ///     Converts a language to its string representation.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;lang&quot;&gt;The language.&lt;/param&gt;
    /// &lt;returns&gt;System.ValueTuple&amp;lt;System.Boolean, System.String&amp;gt;.&lt;/returns&gt;
    public static (bool, string) LanguageToString(Language lang)
    {
        return lang switch
        {
            Language.Danish =&gt; (true, &quot;danish&quot;),
            Language.English =&gt; (true, &quot;english&quot;),
            Language.Italian =&gt; (true, &quot;italian&quot;),
            Language.Russian =&gt; (true, &quot;russian&quot;),
            _ =&gt; (false, &quot;&quot;)
        };
    }

    /// &lt;summary&gt;
    ///     Will convert a string to a language enum. If it was not understood or &quot;russian&quot;, the language will be returned as
    ///     russian (lol)
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;lang&quot;&gt;The language.&lt;/param&gt;
    /// &lt;returns&gt;System.ValueTuple&amp;lt;System.Boolean, Language&amp;gt;.&lt;/returns&gt;
    public static (bool, Language) StringToLanguage(string lang)
    {
        return lang switch
        {
            &quot;danish&quot; =&gt; (true, Language.Danish),
            &quot;english&quot; =&gt; (true, Language.English),
            &quot;italian&quot; =&gt; (true, Language.Italian),
            &quot;russian&quot; =&gt; (true, Language.Russian),
            _ =&gt; (false, Language.Unknown)
        };
    }

    /// &lt;summary&gt;
    ///     Generate a body of text with a default length of 20 words. The length can be overridden to your liking.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;language&quot;&gt;The language.&lt;/param&gt;
    /// &lt;param name=&quot;length&quot;&gt;The number of words in the generated body of text.&lt;/param&gt;
    /// &lt;returns&gt;
    ///     (bool, string): bool: was the operation successful. The string with content if the text generation was
    ///     successful.
    /// &lt;/returns&gt;
    public (bool, string) GenerateText(Language language, int length = 20)
    {
        var generator = _textGenerators.GetValueOrDefault(language);
        if (generator == null) return (false, &quot;&quot;);
        var text = _textGenerators.GetValueOrDefault(language)!.GenerateText(length &gt; 0 ? length : 20);
        return (text != null, text ?? &quot;&quot;);
    }


    /// &lt;summary&gt;
    ///     Generates a title from any given number of tags.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;tags&quot;&gt;A list of tags containing non-empty names. Has to contain either one or many tags.&lt;/param&gt;
    /// &lt;returns&gt;
    ///     (bool, string): the boolean indicates if the operation was successful. The string may contain the title if the
    ///     operation was success full. Otherwise it will be empty.
    /// &lt;/returns&gt;
    public static (bool, string) GenerateTitle(IList&lt;CreateWeightedTagDTO&gt; tags)
    {
        if (!tags.Any()) return (false, &quot;&quot;);

        return tags.Count &gt; 1 ? (true, CreateTitleWithManyTags(tags)) : (true, CreateTitleWithOneTag(tags[0]));
    }

    /// &lt;summary&gt;
    ///     Creates the title with many tags.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;tags&quot;&gt;The tags.&lt;/param&gt;
    /// &lt;returns&gt;System.String.&lt;/returns&gt;
    private static string CreateTitleWithManyTags(IList&lt;CreateWeightedTagDTO&gt; tags)
    {
        var accumulatedTagNames = &quot;&quot;;
        var separator = &quot;&quot;;

        for (var i = 0; i &lt; tags.Count; i++)
        {
            if (i == tags.Count - 1)
            {
                accumulatedTagNames += &quot; and &quot; + tags[i].Name;
                continue;
            }

            accumulatedTagNames += separator + tags[i].Name;
            separator = &quot;, &quot;;
        }

        return CreateTitleWithOneTag(new CreateWeightedTagDTO(accumulatedTagNames, 0));
    }

    /// &lt;summary&gt;
    ///     Creates the title with one tag.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;tag&quot;&gt;The tag.&lt;/param&gt;
    /// &lt;returns&gt;System.String.&lt;/returns&gt;
    private static string CreateTitleWithOneTag(CreateTagDTO tag)
    {
        return GetRandomTitle().Replace(&quot;$1&quot;, tag.Name);
    }

    /// &lt;summary&gt;
    ///     Gets the random title.
    /// &lt;/summary&gt;
    /// &lt;returns&gt;System.String.&lt;/returns&gt;
    private static string GetRandomTitle()
    {
        return TemplateTitles[Rand.Next(TemplateTitles.Length)];
    }

    /// &lt;summary&gt;
    ///     Gets the data file location.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;filename&quot;&gt;The filename.&lt;/param&gt;
    /// &lt;returns&gt;System.String.&lt;/returns&gt;
    private string GetDataFileLocation(string filename)
    {
        return _environment == null
            ? $&quot;{Directory.GetCurrentDirectory()}/../../../../data/{filename}&quot; // Directory for when testing
            : $&quot;{Directory.GetCurrentDirectory()}/../../data/{filename}&quot;;
        // Directory when app is running
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[61,5,61,49,1],[67,5,108,7,1],[125,5,125,69,0],[126,5,126,6,0],[127,9,127,36,0],[128,9,128,69,0],[130,9,130,84,0],[131,9,131,16,0],[131,18,131,30,0],[131,31,131,33,0],[131,34,131,43,0],[132,9,132,10,0],[133,13,133,57,0],[134,13,134,21,0],[134,22,134,31,0],[136,13,136,67,0],[137,9,137,10,0],[138,5,138,6,0],[146,5,146,6,0],[147,9,147,74,0],[148,9,148,60,0],[149,9,149,59,0],[150,9,150,42,0],[151,5,151,6,0],[159,5,159,6,1],[160,9,162,32,1],[162,32,162,48,1],[162,48,163,33,1],[163,33,163,50,1],[163,50,164,33,1],[164,33,164,50,1],[164,50,165,33,1],[165,33,165,50,1],[165,50,166,18,1],[166,18,166,29,0],[166,29,167,11,1],[168,5,168,6,1],[177,5,177,6,1],[178,9,180,25,1],[180,25,180,48,1],[180,48,181,26,1],[181,26,181,50,1],[181,50,182,26,1],[182,26,182,50,1],[182,50,183,26,1],[183,26,183,50,1],[183,50,184,18,1],[184,18,184,43,1],[184,43,185,11,1],[186,5,186,6,1],[198,5,198,6,0],[199,9,199,69,0],[200,9,200,31,0],[200,32,200,51,0],[201,9,201,104,0],[202,9,202,43,0],[203,5,203,6,0],[215,5,215,6,1],[216,9,216,25,1],[216,26,216,45,1],[218,9,218,112,1],[219,5,219,6,1],[227,5,227,6,1],[228,9,228,38,1],[229,9,229,28,1],[231,14,231,23,1],[231,25,231,39,1],[231,41,231,44,1],[232,9,232,10,1],[233,13,233,37,1],[234,13,234,14,1],[235,17,235,63,1],[236,17,236,26,1],[239,13,239,61,1],[240,13,240,30,1],[241,9,241,10,1],[243,9,243,88,1],[244,5,244,6,1],[252,5,252,6,1],[253,9,253,57,1],[254,5,254,6,1],[261,5,261,6,1],[262,9,262,65,1],[263,5,263,6,1],[271,5,271,6,0],[272,9,274,74,0],[276,5,276,6,0]]);
    </script>
  </body>
</html>