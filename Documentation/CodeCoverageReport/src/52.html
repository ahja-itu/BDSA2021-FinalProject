<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\andre\Source\School\BDSA2021-FinalProject\WebService.Infrastructure\ProgrammingLanguageRepository.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
// ***********************************************************************
// Assembly         : WebService.Infrastructure
// Author           : Group BTG
// Created          : 11-29-2021
//
// Last Modified By : Group BTG
// Last Modified On : 12-14-2021
// ***********************************************************************
// &lt;copyright file=&quot;ProgrammingLanguageRepository.cs&quot; company=&quot;BTG&quot;&gt;
//     Copyright (c) . All rights reserved.
// &lt;/copyright&gt;
// &lt;summary&gt;&lt;/summary&gt;
// ***********************************************************************

namespace WebService.Infrastructure;

/// &lt;summary&gt;
///     Class ProgrammingLanguageRepository.
///     Implements the &lt;see cref=&quot;WebService.Core.Shared.IProgrammingLanguageRepository&quot; /&gt;
/// &lt;/summary&gt;
/// &lt;seealso cref=&quot;WebService.Core.Shared.IProgrammingLanguageRepository&quot; /&gt;
public class ProgrammingLanguageRepository : IProgrammingLanguageRepository
{
    /// &lt;summary&gt;
    ///     The context
    /// &lt;/summary&gt;
    private readonly IContext _context;

    /// &lt;summary&gt;
    ///     Initializes a new instance of the &lt;see cref=&quot;ProgrammingLanguageRepository&quot; /&gt; class.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;context&quot;&gt;The context.&lt;/param&gt;
    public ProgrammingLanguageRepository(IContext context)
    {
        _context = context;
    }

    /// &lt;summary&gt;
    ///     Creates a programming language asynchronously.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;programmingLanguage&quot;&gt;The programming language.&lt;/param&gt;
    /// &lt;returns&gt;A Task&amp;lt;System.ValueTuple&amp;gt; representing the asynchronous operation.&lt;/returns&gt;
    public async Task&lt;(Status, ProgrammingLanguageDTO)&gt; CreateAsync(CreateProgrammingLanguageDTO programmingLanguage)
    {
        if (InvalidInput(programmingLanguage))
            return (Status.BadRequest, new ProgrammingLanguageDTO(-1, programmingLanguage.Name));

        var existing = await (from l in _context.ProgrammingLanguages
                where l.Name == programmingLanguage.Name
                select new ProgrammingLanguageDTO(l.Id, l.Name))
            .FirstOrDefaultAsync();

        if (existing != null) return (Status.Conflict, existing);

        var entity = new ProgrammingLanguage(programmingLanguage.Name);

        _context.ProgrammingLanguages.Add(entity);

        await _context.SaveChangesAsync();

        return (Status.Created, new ProgrammingLanguageDTO(entity.Id, entity.Name));
    }

    /// &lt;summary&gt;
    ///     Deletes a programming language asynchronously.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;programmingLanguageId&quot;&gt;The programming language identifier.&lt;/param&gt;
    /// &lt;returns&gt;A Task&amp;lt;Status&amp;gt; representing the asynchronous operation.&lt;/returns&gt;
    public async Task&lt;Status&gt; DeleteAsync(int programmingLanguageId)
    {
        var language = await _context.ProgrammingLanguages.FindAsync(programmingLanguageId);

        if (language == null) return Status.NotFound;

        _context.ProgrammingLanguages.Remove(language);

        await _context.SaveChangesAsync();

        return Status.Deleted;
    }

    /// &lt;summary&gt;
    ///     Reads a programming language asynchronously and a http status.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;programmingLanguageId&quot;&gt;The programming language identifier.&lt;/param&gt;
    /// &lt;returns&gt;A Task&amp;lt;System.ValueTuple&amp;gt; representing the asynchronous operation.&lt;/returns&gt;
    public async Task&lt;(Status, ProgrammingLanguageDTO)&gt; ReadAsync(int programmingLanguageId)
    {
        var query = from l in _context.ProgrammingLanguages
            where l.Id == programmingLanguageId
            select new ProgrammingLanguageDTO(l.Id, l.Name);

        var category = await query.FirstOrDefaultAsync();

        return category == null ? (Status.NotFound, new ProgrammingLanguageDTO(-1, &quot;&quot;)) : (Status.Found, category);
    }

    /// &lt;summary&gt;
    ///     Reads all programming languages asynchronously.
    /// &lt;/summary&gt;
    /// &lt;returns&gt;A Task&amp;lt;IReadOnlyCollection`1&amp;gt; representing the asynchronous operation.&lt;/returns&gt;
    public async Task&lt;IReadOnlyCollection&lt;ProgrammingLanguageDTO&gt;&gt; ReadAsync()
    {
        return await _context.ProgrammingLanguages.Select(l =&gt; new ProgrammingLanguageDTO(l.Id, l.Name)).ToListAsync();
    }

    /// &lt;summary&gt;
    ///     Update a programming language asynchronously.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;programmingProgrammingLanguageDTO&quot;&gt;The programming programming language dto.&lt;/param&gt;
    /// &lt;returns&gt;A Task&amp;lt;Status&amp;gt; representing the asynchronous operation.&lt;/returns&gt;
    public async Task&lt;Status&gt; UpdateAsync(ProgrammingLanguageDTO programmingProgrammingLanguageDTO)
    {
        if (InvalidInput(programmingProgrammingLanguageDTO)) return Status.BadRequest;

        var existing = await (from l in _context.ProgrammingLanguages
                where l.Id != programmingProgrammingLanguageDTO.Id
                where l.Name == programmingProgrammingLanguageDTO.Name
                select new ProgrammingLanguageDTO(l.Id, l.Name))
            .AnyAsync();

        if (existing) return Status.Conflict;

        var entity = await _context.ProgrammingLanguages.FindAsync(programmingProgrammingLanguageDTO.Id);

        if (entity == null) return Status.NotFound;

        entity.Name = programmingProgrammingLanguageDTO.Name;

        await _context.SaveChangesAsync();

        return Status.Updated;
    }

    /// &lt;summary&gt;
    ///     Validates the input.
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;programmingLanguage&quot;&gt;The programming language.&lt;/param&gt;
    /// &lt;returns&gt;&lt;c&gt;true&lt;/c&gt; if the input is valid, &lt;c&gt;false&lt;/c&gt; otherwise.&lt;/returns&gt;
    private static bool InvalidInput(CreateProgrammingLanguageDTO programmingLanguage)
    {
        return programmingLanguage.Name.Length is &gt; 50 or &gt; 50
               || string.IsNullOrEmpty(programmingLanguage.Name)
               || string.IsNullOrEmpty(programmingLanguage.Name)
               || string.IsNullOrWhiteSpace(programmingLanguage.Name)
               || string.IsNullOrWhiteSpace(programmingLanguage.Name);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[33,5,33,59,1],[34,5,34,6,1],[35,9,35,28,1],[36,5,36,6,1],[44,5,44,6,1],[45,9,45,47,1],[46,13,46,98,1],[48,9,51,36,1],[53,9,53,30,1],[53,31,53,66,1],[55,9,55,72,1],[57,9,57,51,1],[59,9,59,43,1],[61,9,61,85,1],[62,5,62,6,1],[70,5,70,6,1],[71,9,71,93,1],[73,9,73,30,1],[73,31,73,54,1],[75,9,75,56,1],[77,9,77,43,1],[79,9,79,31,1],[80,5,80,6,1],[88,5,88,6,1],[89,9,91,61,1],[93,9,93,58,1],[95,9,95,116,1],[96,5,96,6,1],[103,5,103,6,1],[104,9,104,120,1],[105,5,105,6,1],[113,5,113,6,1],[114,9,114,61,1],[114,62,114,87,1],[116,9,120,25,1],[122,9,122,22,1],[122,23,122,46,1],[124,9,124,106,1],[126,9,126,28,1],[126,29,126,52,1],[128,9,128,62,1],[130,9,130,43,1],[132,9,132,31,1],[133,5,133,6,1],[141,5,141,6,1],[142,9,146,71,1],[147,5,147,6,1]]);
    </script>
  </body>
</html>